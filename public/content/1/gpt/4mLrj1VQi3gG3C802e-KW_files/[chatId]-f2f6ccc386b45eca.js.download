(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[794],{4883:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chatbot-iframe/[chatId]",function(){return s(8687)}])},1523:function(e,t,s){"use strict";s.d(t,{X:function(){return d},r:function(){return u}});var n=s(5893),r=s(4184),i=s.n(r),l=s(4432),a=s(2490),o=s(4398),c=s(7234);let d=()=>(0,n.jsx)("div",{className:"flex min-w-full animate-pulse px-4 py-6 sm:px-6",children:(0,n.jsx)("div",{className:"flex flex-grow space-x-3",children:(0,n.jsx)("div",{className:"min-w-0 flex-1",children:(0,n.jsxs)("div",{className:"space-y-4 pt-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,n.jsx)("div",{className:"col-span-2 h-2 rounded bg-zinc-500"}),(0,n.jsx)("div",{className:"col-span-1 h-2 rounded bg-zinc-500"})]}),(0,n.jsx)("div",{className:"h-2 rounded bg-zinc-500"})]})})})});function u(e){let{message:t,onlyUserMessageStyles:s,isFirstMessageFromUser:r,chatbot:d,chatbotProfilePicturePreviewUrl:u,shouldRemoveChatbotProfilePicture:h,chatbotStyles:f}=e,{role:m="assistant",content:g}=t;if(!g)return null;let x=(null==f?void 0:f.user_message_color)||o.jB.user_message_color;return(0,n.jsx)("div",{className:"assistant"!=m?"float-right clear-both ml-8":"float-left clear-both mr-8",children:(0,n.jsx)("div",{className:"float-right mb-3 overflow-auto rounded-lg py-3 px-4",style:"user"===m?{backgroundColor:x,color:(0,c.Z)(x).isDark()?"white":"black"}:(null==f?void 0:f.theme)!=="dark"||s?{backgroundColor:"#f4f4f5",color:"black"}:{backgroundColor:"#3f3f46",color:"white"},children:(0,n.jsx)("div",{className:"flex space-x-3",children:(0,n.jsx)("div",{className:i()("flex-1 gap-4",{dark:(null==f?void 0:f.theme)==="dark"}),children:(0,n.jsx)("div",{className:"prose text-inherit text-left dark:prose-invert",children:(0,n.jsx)(l.D,{children:g,remarkPlugins:[a.Z],linkTarget:"_blank"})})})})})})}},2561:function(e,t,s){"use strict";var n=s(5893),r=s(7294),i=s(5675),l=s.n(i),a=s(3508),o=s(243),c=s(4184),d=s.n(c);t.Z=function(e){let{chatbot:t,chatbotStyles:s,isStillStreaming:i,setMessages:c,initialMessages:u,isReadOnly:h,shouldRemoveChatbotProfilePicture:f,chatbotProfilePicturePreviewUrl:m,conversationIdRef:g}=e,[x,v]=r.useState(!1);return(0,r.useEffect)(()=>{let e=e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.windowInnerWidth)&&(e.data.windowInnerWidth<640?v(!0):v(!1))};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[]),(0,n.jsxs)("div",{className:d()("flex justify-between py-1 mb-4 ",{"mb-2":h," z-10":!h}),style:(null==s?void 0:s.theme)==="dark"?{borderBottom:"1px solid #3f3f46",background:"black"}:{borderBottom:"1px solid #f4f4f5",background:"white"},children:[(0,n.jsxs)("div",{className:"flex items-center",children:[!0!==f&&(m||(null==s?void 0:s.profile_picture_file))&&(0,n.jsx)(l(),{src:m||"chatbots-profile-pictures/"+(null==s?void 0:s.profile_picture_file),alt:"profile picture",width:35,height:35,priority:!0,className:"rounded-full m-1 mr-2"}),(null==s?void 0:s.display_name)&&(0,n.jsx)("h1",{className:d()("text-lg font-bold  ",{"  text-zinc-300":(null==s?void 0:s.theme)==="dark","  text-zinc-700":(null==s?void 0:s.theme)!=="dark"}),children:null==s?void 0:s.display_name})]}),(0,n.jsxs)("div",{className:"flex justify-center items-center",children:[(0,n.jsx)("button",{className:d()("text-sm py-3 ",{" hover:text-zinc-400 text-zinc-300":(null==s?void 0:s.theme)==="dark"," hover:text-zinc-600 text-zinc-700":(null==s?void 0:s.theme)!=="dark"}),onClick:()=>{if(t&&c&&u&&!h&&!i){try{localStorage.removeItem(t.id)}catch(e){console.log(e)}c(u.filter(e=>e.content)),g&&(g.current="")}},children:(0,n.jsx)(a,{className:"h-5 w-5"})}),x&&(0,n.jsx)("button",{className:d()("text-sm py-3 ml-3",{" hover:text-zinc-400 text-zinc-300":(null==s?void 0:s.theme)==="dark"," hover:text-zinc-600 text-zinc-700":(null==s?void 0:s.theme)!=="dark"}),onClick:()=>{t&&c&&u&&!h&&window.parent.postMessage({closeIframe:!0},"*")},children:(0,n.jsx)(o,{className:"h-6 w-6"})})]})]})}},8687:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSP:function(){return k},default:function(){return _}});var n=s(5893),r=s(7294),i=s(1523),l=s(1163),a=s(4184),o=s.n(a),c=s(1664),d=s.n(c),u=s(9431),h=s(4853),f=s(8680),m=s(8690),g=s(2561),x=s(2483),v=s(4398),p=s(2285),b=s(3416);let w=e=>{let{chatbot:t,input:s,setInput:i,sendMessage:l,loading:a,isStillStreaming:c,messages:g,initialMessages:x,styles:b,subscription:w}=e,y=(0,r.createRef)(),j=async e=>{e&&y.current&&(y.current.reset(),l(s,e),i(""))},k=e=>{if(e&&e.preventDefault(),s&&!a&&!c){if(0===Math.floor(15*Math.random())){var t;null==y||null===(t=y.current)||void 0===t||t.execute()}else l(s,f.Wp),i("")}},_=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(_.current){_.current.style.height="1rem";let e=_.current.scrollHeight;_.current.style.height=e+"px"}},[_,s]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("form",{onSubmit:k,children:[(0,n.jsx)("div",{className:"py-2",children:t.suggested_messages&&t.suggested_messages.map((e,t)=>(0,n.jsx)("button",{onClick:()=>{a||c||l(e,f.Wp)},type:"button",className:o()("rounded-xl  mr-1 mt-1 py-2 px-3 text-sm  ",{"bg-zinc-800 hover:bg-zinc-700 text-white":(null==b?void 0:b.theme)==="dark","bg-zinc-100 hover:bg-zinc-200":(null==b?void 0:b.theme)!=="dark"}),children:e},t))}),(0,n.jsxs)("div",{className:"flex pl-3 p-1 rounded ",style:(null==b?void 0:b.theme)==="dark"?{background:"black",border:"1px solid #3f3f46",color:"white"}:{background:"white",border:"1px solid #e4e4e7"},children:[(0,n.jsx)("div",{className:"flex items-center w-full",children:(0,n.jsx)("textarea",{"aria-label":"chat input",required:!0,maxLength:v._R,rows:1,ref:_,className:" m-0 w-full min-h-[1.5rem] max-h-36 pr-7 resize-none border-0 bg-inherit flex-1 appearance-none rounded-md focus:ring-0 focus-visible:ring-0 focus:outline-none ",value:s,onChange:e=>{i(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||k(e)}})}),(0,n.jsx)("div",{className:"flex items-end",children:(0,n.jsx)("button",{type:"submit",className:" flex-none p-2",disabled:!s||a||c,children:(0,n.jsx)(u,{className:"h-5 w-5"})})})]}),(0,n.jsx)(h.Z,{ref:y,size:"invisible",sitekey:"6LdQyeUkAAAAAK_5dC_7EsRhIi9MSVZC2hc_irOz",onChange:j}),!m.gC.has(t.user_id||"")&&(0,p.lF)(w)?(0,n.jsxs)("p",{className:"text-center text-xs py-2 ",style:(null==b?void 0:b.theme)==="dark"?{color:"#b4b4b5"}:{color:"#3f3f46"},children:["Powered By"," ",(0,n.jsx)(d(),{target:"_blank",className:"font-semibold",style:(null==b?void 0:b.theme)==="dark"?{color:"#f4f4f5"}:{color:"#141410"},href:"/",children:"Chatbase.co"})]}):(0,n.jsx)("div",{className:"pt-4"})]})})},y={genericError:{title:"Something went wrong",description:"Please try again later"}};function j(e){let{chatbot:t,subscription:s}=e,{id:a}=t,o=t.styles||v.jB,c=t.initial_messages?t.initial_messages.map(e=>({role:"assistant",content:e})):[{role:"assistant",content:v.Um}],[d,u]=(0,r.useState)(c.filter(e=>e.content)),[h,f]=(0,r.useState)(""),[m,p]=(0,r.useState)(!1),[j,k]=(0,r.useState)(!1),[_,N]=(0,r.useState)(!1),[S,z]=(0,r.useState)(!1),[E,I]=(0,r.useState)("warning"),[C,R]=(0,r.useState)(y.genericError),M=(0,r.useRef)(null),T=()=>{var e;null===(e=M.current)||void 0===e||e.scrollIntoView({block:"nearest"})},W=()=>window.innerHeight+window.scrollY+50>=document.body.offsetHeight;(0,r.useEffect)(()=>{var e;let s=(null===(e=t.initial_messages)||void 0===e?void 0:e.length)||1;d.length<=s||(_&&T(),W()&&T(),N(!1))},[d,_]),(0,r.useEffect)(()=>{try{u(localStorage.getItem(t.id)?JSON.parse(localStorage.getItem(t.id)||""):c.filter(e=>e.content))}catch(e){console.log(e)}},[]),(0,r.useEffect)(()=>{if(!j)try{localStorage.setItem(t.id,JSON.stringify(d))}catch(e){console.log(e)}},[j,d]);let A=(0,r.useRef)("");(0,r.useEffect)(()=>{if(!A.current){A.current=(0,b.x0)()+"-"+a;return}},[A.current]),(0,l.useRouter)();let B=async(e,s)=>{if(!m)try{let n=[...d,{content:e,role:"user"}];u(n),p(!0),N(!0);let r=n.slice(-30),i=await fetch("/api/fe/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:r,captchaCode:s,chatId:a,conversationId:A.current})});if(!i.ok){let l=await i.json();if(429===i.status)throw Error(t.ip_limit_message||v.zk);throw Error((null==l?void 0:l.message)||i.statusText)}let o=i.body;if(!o)return;let c=o.getReader(),h=new TextDecoder,f=!1;for(p(!1),W()&&N(!0);!f;){k(!0);let{value:g,done:x}=await c.read();f=x;let b=h.decode(g),w="";w=b,u(e=>{if("assistant"!==e[e.length-1].role)return[...n,{content:w,role:"assistant"}];{let t=e.pop();return[...e,{content:(null==t?void 0:t.content)+w,role:"assistant"}]}})}k(!1)}catch(j){console.log(j),z(!0),j instanceof Error?(console.log(j),R({description:j.message})):R(y.genericError),I("warning"),p(!1)}};return(0,n.jsxs)("div",{className:"min-h-screen px-4 flex flex-col ",style:(null==o?void 0:o.theme)==="dark"?{background:"black"}:{background:"white"},children:[(0,n.jsx)("div",{className:" sticky top-0 w-full",children:(0,n.jsx)(g.Z,{chatbot:t,chatbotStyles:t.styles,initialMessages:c,setMessages:u,isStillStreaming:j,conversationIdRef:A})}),(0,n.jsxs)("div",{className:"flex-grow ",children:[d.map((e,s)=>{let{content:r,role:l}=e;return(0,n.jsx)(i.r,{message:{role:l,content:r},chatbot:t,isFirstMessageFromUser:0===s||d[s-1].role!==d[s].role,chatbotStyles:t.styles},s)}),m&&(0,n.jsx)(i.X,{})]}),(0,n.jsx)("div",{className:" sticky bottom-0 bg-inherit",children:(0,n.jsx)(w,{chatbot:t,isStillStreaming:j,loading:m,input:h,setInput:f,sendMessage:B,messages:d,initialMessages:c,styles:o,subscription:s})}),(0,n.jsx)(x.Z,{show:S,setShow:z,title:C.title,description:C.description,variant:E}),(0,n.jsx)("div",{ref:M})]})}var k=!0,_=function(e){let{chatbot:t,subscription:s}=e;return(0,l.useRouter)(),(0,n.jsx)(j,{chatbot:t,subscription:s})}},3431:function(e,t,s){"use strict";function n(e){let{src:t,width:s,quality:n}=e;return t.startsWith("http")||t.startsWith("data:image")?t:"".concat("https://backend.chatbase.co","/storage/v1/object/public/").concat(t,"?width=").concat(s,"&quality=").concat(n||100)}s.r(t),s.d(t,{default:function(){return n}})},4398:function(e,t,s){"use strict";s.d(t,{Qv:function(){return l},Um:function(){return r},_R:function(){return o},f$:function(){return n},jB:function(){return c},jW:function(){return i},zk:function(){return a}});let n='I want you to act as a document that I am having a conversation with. Your name is "AI Assistant". You will provide me with answers from the given info. If the answer is not included, say exactly "Hmm, I am not sure." and stop after that. Refuse to answer any question not about the info. Never break character.',r="Hi! What can I help you with?",i=20,l=240,a="Too many messages in a row",o=750,c={theme:"light",user_message_color:"#3B81F6",button_color:"#000000",display_name:"",auto_open_chat_window_after:3,align_chat_button:"right"}}},function(e){e.O(0,[675,944,623,652,774,888,179],function(){return e(e.s=4883)}),_N_E=e.O()}]);